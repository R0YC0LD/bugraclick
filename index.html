<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON CLICKER: BLACK MARKET</title>
    <style>
        /* --- CSS --- */
        :root {
            --primary: #00f3ff;
            --secondary: #ff0055;
            --gold: #ffcc00; /* Para Rengi */
            --bg: #050505;
            --glass: rgba(10, 20, 30, 0.95);
        }

        @font-face {
            font-family: 'Cyber';
            src: local('Courier New');
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-user-select: none;
            cursor: crosshair;
        }

        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Arkaplan */
        .grid-bg {
            position: absolute;
            width: 200vw;
            height: 200vh;
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            transform: rotateX(60deg) translateY(-100px) translateZ(-200px);
            animation: gridScroll 20s linear infinite;
            z-index: -1;
        }

        @keyframes gridScroll {
            0% { transform: rotateX(60deg) translateY(0) translateZ(-200px); }
            100% { transform: rotateX(60deg) translateY(50px) translateZ(-200px); }
        }

        /* UI */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 10;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .hud-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .stat-box {
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border: 1px solid var(--primary);
            margin-bottom: 10px;
            pointer-events: auto; /* Tıklanabilir */
        }

        .hud-bar {
            width: 250px;
            height: 12px;
            background: #111;
            border: 1px solid var(--primary);
            margin-top: 5px;
            position: relative;
        }

        .hud-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.2s;
            box-shadow: 0 0 10px var(--primary);
        }

        #score-display {
            font-size: 5rem;
            font-weight: 900;
            text-align: center;
            text-shadow: 0 0 20px rgba(255,255,255,0.2);
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            transition: 0.1s;
        }

        #bits-display {
            color: var(--gold);
            text-shadow: 0 0 10px var(--gold);
            font-size: 1.5rem;
        }

        /* MARKET BUTONU & EKRANI */
        #btn-shop {
            pointer-events: auto;
            background: black;
            border: 2px solid var(--gold);
            color: var(--gold);
            padding: 10px 20px;
            font-family: inherit;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            text-transform: uppercase;
            transition: 0.3s;
        }
        #btn-shop:hover {
            background: var(--gold);
            color: black;
        }

        #shop-modal {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 600px;
            background: var(--glass);
            border: 2px solid var(--gold);
            padding: 20px;
            z-index: 50;
            display: flex;
            flex-direction: column;
            gap: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 50px rgba(255, 204, 0, 0.2);
        }

        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #333;
            padding: 15px;
            background: rgba(0,0,0,0.6);
            transition: 0.2s;
        }
        
        .shop-item:hover { border-color: var(--gold); }

        .shop-info h3 { color: var(--gold); font-size: 1.2rem; margin-bottom: 5px; }
        .shop-info p { color: #aaa; font-size: 0.8rem; }

        .btn-buy {
            background: transparent;
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 10px;
            cursor: pointer;
            min-width: 100px;
        }
        .btn-buy:hover { background: var(--gold); color: black; }
        .btn-buy:disabled { border-color: #555; color: #555; cursor: not-allowed; background: transparent; }

        .close-shop {
            position: absolute; top: 10px; right: 10px;
            background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;
        }

        /* Overlay Ekranlar */
        .overlay-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5,5,5,0.95);
            z-index: 100;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
        }
        
        .hidden { display: none !important; }

        .floating-text {
            position: absolute;
            font-weight: bold;
            font-size: 1.5rem;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
        }
        @keyframes floatUp { to { opacity: 0; transform: translateY(-80px); } }

        .btn-start {
            padding: 15px 40px;
            font-size: 1.5rem;
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            cursor: pointer;
            font-family: inherit;
            margin-top: 20px;
        }
        .btn-start:hover { background: var(--primary); color: black; }

    </style>
</head>
<body>

    <div class="grid-bg"></div>
    
    <div id="ui-layer">
        <div class="hud-row">
            <div class="stat-box">
                <div>SYSTEM INTEGRITY</div>
                <div class="hud-bar"><div class="hud-fill" id="integrity-bar"></div></div>
                <div style="font-size: 0.8rem; margin-top: 5px; color: var(--primary);">TARGET: 5000</div>
            </div>
            
            <div class="stat-box" style="text-align: right; border-color: var(--gold);">
                <div id="bits-display">BITS: 0</div>
                <div style="font-size: 0.8rem; color: #888;">CURRENCY</div>
            </div>
        </div>

        <div class="hud-row" style="justify-content: flex-end; align-items: flex-end; height: 100%;">
             <div style="text-align: right;">
                <div id="risk-display" style="font-size: 1.5rem; color: white;">RISK: x1.0</div>
                <button id="btn-shop" onclick="game.openShop()">OPEN MARKET</button>
            </div>
        </div>
    </div>

    <div id="score-display">1000</div>

    <div id="shop-modal" class="hidden">
        <button class="close-shop" onclick="game.closeShop()">X</button>
        <h2 style="color: var(--gold); text-align: center; margin-bottom: 20px;">/// BLACK MARKET</h2>
        
        <div class="shop-item">
            <div class="shop-info">
                <h3>OVERCLOCK CPU</h3>
                <p>Tıklama başına daha fazla Integrity puanı.</p>
                <p style="color: var(--primary);">Current Level: <span id="lvl-power">1</span></p>
            </div>
            <button class="btn-buy" id="btn-buy-power" onclick="game.buyUpgrade('power')">
                250 BITS
            </button>
        </div>

        <div class="shop-item">
            <div class="shop-info">
                <h3>FIREWALL v2.0</h3>
                <p>Kötü tıklamalarda kaybedilen puanı azaltır.</p>
                <p style="color: var(--success);">Defense: <span id="lvl-def">0%</span></p>
            </div>
            <button class="btn-buy" id="btn-buy-def" onclick="game.buyUpgrade('defense')">
                400 BITS
            </button>
        </div>

        <div class="shop-item">
            <div class="shop-info">
                <h3>CRYPTO MINER</h3>
                <p>Her tıklamada daha fazla BITS kazandırır.</p>
                <p style="color: var(--gold);">Multiplier: x<span id="lvl-income">1.0</span></p>
            </div>
            <button class="btn-buy" id="btn-buy-income" onclick="game.buyUpgrade('income')">
                300 BITS
            </button>
        </div>
    </div>

    <div id="start-screen" class="overlay-screen">
        <h1 style="color: var(--primary); font-size: 3rem; text-shadow: 0 0 20px var(--primary);">NEON HACKER</h1>
        <p>Market Update Loaded.</p>
        <button class="btn-start" onclick="game.start()">CONNECT</button>
    </div>

    <div id="end-screen" class="overlay-screen hidden">
        <h1 id="end-title" style="font-size: 4rem;">GAME OVER</h1>
        <p id="end-reason">Connection Lost.</p>
        <button class="btn-start" onclick="game.restart()">RETRY</button>
    </div>

    <script>
        class SoundEngine {
            constructor() {
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
            }
            play(type) {
                if (this.ctx.state === 'suspended') this.ctx.resume();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                if (type === 'coin') {
                    osc.frequency.setValueAtTime(1000, this.ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(2000, this.ctx.currentTime + 0.1);
                    osc.type = 'sine';
                } else if (type === 'buy') {
                    osc.frequency.setValueAtTime(400, this.ctx.currentTime);
                    osc.frequency.linearRampToValueAtTime(800, this.ctx.currentTime + 0.1);
                    osc.type = 'square';
                } else if (type === 'hit') {
                    osc.frequency.setValueAtTime(800, this.ctx.currentTime);
                    osc.type = 'triangle';
                } else { // loss
                    osc.frequency.setValueAtTime(150, this.ctx.currentTime);
                    osc.type = 'sawtooth';
                }

                gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.15);

                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.15);
            }
        }

        class Game {
            constructor() {
                this.audio = new SoundEngine();
                this.integrity = 1000;
                this.bits = 0;
                this.risk = 1.0;
                this.isPlaying = false;
                this.target = 5000;
                this.isShopOpen = false;

                // Market & Yetenek Değişkenleri
                this.stats = {
                    power: 1.0,         // Tıklama Gücü Çarpanı
                    defense: 0.0,       // Risk Defansı (%0 - %80 arası)
                    incomeMult: 1.0     // Para Kazanma Çarpanı
                };

                this.prices = {
                    power: 250,
                    defense: 400,
                    income: 300
                };

                // UI Referansları
                this.ui = {
                    score: document.getElementById('score-display'),
                    bar: document.getElementById('integrity-bar'),
                    bits: document.getElementById('bits-display'),
                    risk: document.getElementById('risk-display'),
                    shop: document.getElementById('shop-modal'),
                    
                    // Butonlar
                    btnPower: document.getElementById('btn-buy-power'),
                    btnDef: document.getElementById('btn-buy-def'),
                    btnIncome: document.getElementById('btn-buy-income'),
                    
                    // Label'lar
                    lblPower: document.getElementById('lvl-power'),
                    lblDef: document.getElementById('lvl-def'),
                    lblIncome: document.getElementById('lvl-income')
                };

                document.addEventListener('mousedown', (e) => {
                    // Eğer market açıksa veya butonlara basılıyorsa tıklama sayma
                    if (this.isShopOpen || e.target.tagName === 'BUTTON' || e.target.closest('#shop-modal')) return;
                    this.click(e);
                });
            }

            start() {
                this.integrity = 1000;
                this.bits = 200; // Başlangıç parası (Hediye)
                this.risk = 1.0;
                this.isPlaying = true;
                
                // Statları sıfırla
                this.stats = { power: 1.0, defense: 0.0, incomeMult: 1.0 };
                this.prices = { power: 250, defense: 400, income: 300 };
                
                document.getElementById('start-screen').classList.add('hidden');
                document.getElementById('end-screen').classList.add('hidden');
                this.updateUI();
                this.updateShopUI();
            }

            restart() { this.start(); }

            click(e) {
                if (!this.isPlaying) return;

                // 1. Risk Hesaplama
                this.risk += 0.05;
                if (this.risk > 4.0) this.risk = 4.0; // Maksimum risk sınırı

                // 2. Şans Faktörü (%70 Şans)
                const isSuccess = Math.random() > 0.30;
                
                // Temel Değerler
                let basePoints = Math.floor(Math.random() * 20 + 10); // 10-30 arası puan
                let baseBits = Math.floor(Math.random() * 10 + 5);    // 5-15 arası para

                if (isSuccess) {
                    // --- KAZANÇ ---
                    // Formül: (Baz * Risk * Güçlendirme)
                    let pointsGain = Math.floor(basePoints * this.risk * this.stats.power);
                    
                    // Para her zaman kazanılır ama başarılı tıklamada daha çok
                    let bitsGain = Math.floor(baseBits * this.risk * this.stats.incomeMult);

                    this.integrity += pointsGain;
                    this.bits += bitsGain;
                    
                    this.audio.play('hit');
                    this.floatText(e.clientX, e.clientY, `+${pointsGain}`, '#00f3ff');
                    this.floatText(e.clientX + 30, e.clientY - 20, `+${bitsGain} BITS`, '#ffcc00');

                } else {
                    // --- KAYIP ---
                    // Defans, kaybı azaltır (Defense 0.5 ise hasarın yarısını emer)
                    let pointsLoss = Math.floor((basePoints * 1.5) * this.risk);
                    
                    // Defans Uygula
                    let mitigatedLoss = Math.floor(pointsLoss * (1 - this.stats.defense));
                    
                    this.integrity -= mitigatedLoss;
                    
                    // Kayıp durumunda da azıcık para verelim (Teselli)
                    let pityBits = Math.floor((baseBits / 2) * this.stats.incomeMult);
                    this.bits += pityBits;

                    this.audio.play('loss');
                    this.floatText(e.clientX, e.clientY, `-${mitigatedLoss}`, '#ff0055');
                }

                this.animateScore();
                this.updateUI();
                this.checkGame();
            }

            openShop() {
                this.isShopOpen = true;
                this.ui.shop.classList.remove('hidden');
                this.updateShopUI();
            }

            closeShop() {
                this.isShopOpen = false;
                this.ui.shop.classList.add('hidden');
            }

            buyUpgrade(type) {
                let price = this.prices[type];
                if (this.bits >= price) {
                    this.bits -= price;
                    this.audio.play('buy');

                    // Özelliği geliştir ve fiyatı arttır
                    if (type === 'power') {
                        this.stats.power += 0.5; // %50 güç artışı
                        this.prices.power = Math.floor(this.prices.power * 1.5);
                    } else if (type === 'defense') {
                        if (this.stats.defense < 0.8) { // Max %80 defans
                            this.stats.defense += 0.1; // %10 defans artışı
                            this.prices.defense = Math.floor(this.prices.defense * 1.6);
                        }
                    } else if (type === 'income') {
                        this.stats.incomeMult += 0.5; // Para kazanma artışı
                        this.prices.income = Math.floor(this.prices.income * 1.4);
                    }

                    this.updateUI();
                    this.updateShopUI();
                }
            }

            updateUI() {
                this.ui.score.innerText = this.integrity;
                this.ui.bits.innerText = `BITS: ${this.bits}`;
                this.ui.risk.innerText = `RISK: x${this.risk.toFixed(2)}`;

                let percent = (this.integrity / this.target) * 100;
                this.ui.bar.style.width = Math.max(0, Math.min(100, percent)) + "%";

                // Bar Rengi
                if (this.integrity < 500) this.ui.bar.style.backgroundColor = '#ff0055'; // Kritik
                else if (this.integrity > 4000) this.ui.bar.style.backgroundColor = '#00ff6a'; // Bitmeye yakın
                else this.ui.bar.style.backgroundColor = '#00f3ff';
            }

            updateShopUI() {
                // Button Textleri (Fiyatlar)
                this.ui.btnPower.innerText = `${this.prices.power} BITS`;
                this.ui.btnIncome.innerText = `${this.prices.income} BITS`;
                
                // Defans max kontrolü
                if (this.stats.defense >= 0.8) {
                    this.ui.btnDef.innerText = "MAX";
                    this.ui.btnDef.disabled = true;
                } else {
                    this.ui.btnDef.innerText = `${this.prices.defense} BITS`;
                    this.ui.btnDef.disabled = this.bits < this.prices.defense;
                }

                // Butonların aktiflik durumu
                this.ui.btnPower.disabled = this.bits < this.prices.power;
                this.ui.btnIncome.disabled = this.bits < this.prices.income;

                // Level Textleri
                this.ui.lblPower.innerText = `x${this.stats.power.toFixed(1)}`;
                this.ui.lblDef.innerText = `%${(this.stats.defense * 100).toFixed(0)}`;
                this.ui.lblIncome.innerText = `x${this.stats.incomeMult.toFixed(1)}`;
            }

            animateScore() {
                this.ui.score.style.transform = `translate(-50%, -50%) scale(${1 + Math.random()*0.1})`;
                setTimeout(() => {
                    this.ui.score.style.transform = `translate(-50%, -50%) scale(1)`;
                }, 50);
            }

            floatText(x, y, text, color) {
                const el = document.createElement('div');
                el.className = 'floating-text';
                el.innerText = text;
                el.style.left = x + 'px';
                el.style.top = y + 'px';
                el.style.color = color;
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 800);
            }

            checkGame() {
                if (this.integrity >= this.target) {
                    this.end(true);
                } else if (this.integrity <= 0) {
                    this.integrity = 0;
                    this.end(false);
                }
            }

            end(win) {
                this.isPlaying = false;
                document.getElementById('end-screen').classList.remove('hidden');
                const title = document.getElementById('end-title');
                const reason = document.getElementById('end-reason');

                if (win) {
                    title.innerText = "SYSTEM HACKED";
                    title.style.color = "#00ff6a";
                    reason.innerText = `Başarıyla sızdın! Toplam BITS: ${this.bits}`;
                } else {
                    title.innerText = "CONNECTION LOST";
                    title.style.color = "#ff0055";
                    reason.innerText = "Sinyal koptu. Sistem seni attı.";
                }
            }
        }

        const game = new Game();
    </script>
</body>
</html>
